<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æƒŠè›°è®¡åˆ’">

    <title>ç­‰æƒŠè›°</title>
    
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            /* ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦ä¹¦æ³•å­—ä½“ï¼Œç§’å¼€ä¸å¡ */
            font-family: "Xingkai SC", "STKaiti", "KaiTi", "æ¥·ä½“", "Lishu", serif;
            margin: 0;
            padding: 0;
            /* å…³é”®ï¼šä½¿ç”¨ dvh é€‚åº” Safari çš„åŠ¨æ€åœ°å€æ  */
            height: 100vh; 
            height: 100dvh; 
            width: 100vw;
            display: flex;
            justify-content: center;
            background-color: #333; /* ç”µè„‘ç«¯èƒŒæ™¯ */
            overflow: hidden; /* ç¦æ­¢æ•´ä½“é¡µé¢æ»šåŠ¨ */
        }

        /* --- æ ¸å¿ƒå®¹å™¨ --- */
        #app {
            width: 100%;
            max-width: 600px; /* ç”µè„‘ç«¯é™åˆ¶å®½åº¦ */
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
            
            /* èƒŒæ™¯ï¼šæƒŠè›°é’ç»¿æ¸å˜ */
            background: linear-gradient(160deg, #a1c4fd 0%, #c2e9fb 100%);
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* èƒŒæ™¯çº¹ç† */
        #app::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E");
            z-index: 0; pointer-events: none;
        }

        /* æ°´å° */
        .bg-watermark {
            position: absolute; top: 18%; left: 50%; transform: translateX(-50%);
            font-size: 80px; color: rgba(255, 255, 255, 0.4); z-index: 0; pointer-events: none; white-space: nowrap; font-weight: bold;
        }

        /* --- é¡¶éƒ¨æ  --- */
        .header {
            /* å¢åŠ é¡¶éƒ¨å†…è¾¹è·ï¼Œé¿å¼€ iPhone åˆ˜æµ·/åŠ¨æ€å²› */
            padding: 15px;
            padding-top: calc(15px + env(safe-area-inset-top)); 
            text-align: center;
            font-size: 24px; 
            color: #2c3e50;
            z-index: 10;
            border-bottom: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1); /* å¾®å¾®åŠé€æ˜ */
            backdrop-filter: blur(5px);
        }

        /* --- åˆ—è¡¨åŒºåŸŸ --- */
        #chat-container {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            /* iOS æ»šåŠ¨å›å¼¹æ•ˆæœ */
            -webkit-overflow-scrolling: touch; 
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 1; 
        }

        /* --- ä»»åŠ¡æ°”æ³¡ --- */
        .message-row { display: flex; justify-content: flex-end; animation: fadeIn 0.4s ease; }

        .bubble {
            max-width: 92%;
            padding: 12px 18px;
            border-radius: 16px;
            border-bottom-right-radius: 2px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 19px;
            display: flex; flex-direction: row; align-items: baseline; gap: 10px; flex-wrap: wrap;
        }

        .done { background-color: rgba(255, 255, 255, 0.5); color: #888; text-decoration: line-through; box-shadow: none; }
        .task-text { flex: 1; word-break: break-all; }
        .task-time { font-size: 14px; color: #2980b9; font-family: -apple-system, sans-serif; font-weight: bold; opacity: 0.9; white-space: nowrap;}
        .overdue { color: #c0392b !important; }

        /* --- åº•éƒ¨è¾“å…¥åŒº --- */
        .input-area {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 12px;
            /* å…³é”®ï¼šé¿å¼€åº•éƒ¨å°é»‘æ¡ï¼ŒåŒæ—¶ç•™å‡ºä¸€ç‚¹è·ç¦» */
            padding-bottom: calc(12px + env(safe-area-inset-bottom));
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 10;
        }

        .clock-icon { font-size: 26px; }
        .date-wrapper { position: relative; display: flex; align-items: center; }
        input[type="datetime-local"] { position: absolute; left: 0; top: 0; width: 100%; height: 100%; opacity: 0; }

        input[type="text"] {
            flex: 1; height: 44px; border: 1px solid rgba(0,0,0,0.1); border-radius: 22px; 
            padding: 0 16px; font-size: 17px; background-color: rgba(255,255,255,0.9); font-family: inherit;
        }
        input[type="text"]:focus { outline: none; background-color: #fff; }

        button {
            height: 44px; padding: 0 24px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white; border: none; border-radius: 22px;
            font-size: 18px; font-family: inherit; font-weight: bold;
            box-shadow: 0 4px 12px rgba(79, 172, 254, 0.4);
        }
        button:active { transform: scale(0.96); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="app">
        <div class="bg-watermark">ç­‰æƒŠè›°</div>
        <div class="header">ğŸ“… å¾…åŠäº‹é¡¹</div>
        <div id="chat-container"></div>
        
        <div class="input-area">
            <div class="date-wrapper">
                <span class="clock-icon">â°</span>
                <input type="datetime-local" id="timeInput">
            </div>
            <input type="text" id="taskInput" placeholder="å†™ä¸‹è®¡åˆ’..." autocomplete="off">
            <button onclick="addTask()">å‘é€</button>
        </div>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const taskInput = document.getElementById('taskInput');
        const timeInput = document.getElementById('timeInput');
        
        // å°è¯•è‡ªåŠ¨èšç„¦ï¼ˆåœ¨ App æ¨¡å¼ä¸‹ä½“éªŒæ›´å¥½ï¼‰
        // window.onload = () => taskInput.focus();

        let tasks = JSON.parse(localStorage.getItem('jingzheTasks')) || [];
        if (tasks.length === 0) { renderWelcome(); } else { renderTasks(); }

        function addTask() {
            const text = taskInput.value.trim();
            const timeVal = timeInput.value;
            if (!text) return;
            const newTask = { id: Date.now(), text: text, targetTime: timeVal, done: false };
            tasks.push(newTask); saveData(); appendTask(newTask);
            taskInput.value = ''; timeInput.value = ''; scrollToBottom();
        }

        function appendTask(task) {
            const row = document.createElement('div'); row.className = 'message-row'; row.id = 'task-' + task.id;
            const bubble = document.createElement('div'); bubble.className = `bubble ${task.done ? 'done' : ''}`;
            let htmlContent = `<div class="task-text">${task.text}</div>`;
            if (task.targetTime) {
                const formattedTime = formatTime(task.targetTime);
                const isOverdue = checkOverdue(task.targetTime) && !task.done;
                htmlContent += `<div class="task-time ${isOverdue ? 'overdue' : ''}">${isOverdue ? 'âš ï¸' : ''} ${formattedTime}</div>`;
            }
            bubble.innerHTML = htmlContent;
            bubble.onclick = () => { task.done = !task.done; saveData(); renderTasks(); };
            bubble.ondblclick = () => { if(confirm('åˆ é™¤?')) { tasks = tasks.filter(t => t.id !== task.id); saveData(); row.remove(); }};
            row.appendChild(bubble); chatContainer.appendChild(row);
        }

        function renderTasks() { chatContainer.innerHTML = ''; tasks.forEach(task => appendTask(task)); scrollToBottom(); }
        function renderWelcome() {
            const row = document.createElement('div'); row.className = 'message-row'; row.style.justifyContent = 'center'; 
            row.innerHTML = `<div class="bubble" style="background:none; border:none; box-shadow:none; color: #555; text-align:center;">å…¨å±ç•…äº«ç‰ˆ<br>æ˜¥é›·å“ï¼Œä¸‡ç‰©é•¿</div>`;
            chatContainer.appendChild(row);
        }

        function formatTime(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString); const now = new Date();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const hour = date.getHours().toString().padStart(2, '0');
            const minute = date.getMinutes().toString().padStart(2, '0');
            if (date.toDateString() === now.toDateString()) return `${hour}:${minute}`;
            return `${month}-${day} ${hour}:${minute}`;
        }

        function checkOverdue(isoString) { if (!isoString) return false; return new Date(isoString) < new Date(); }
        function saveData() { localStorage.setItem('jingzheTasks', JSON.stringify(tasks)); }
        function scrollToBottom() { setTimeout(() => { chatContainer.scrollTop = chatContainer.scrollHeight; }, 50); }
        taskInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') addTask(); });
    </script>
</body>
</html>
